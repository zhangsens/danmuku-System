!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.cDanmaku=i():t.cDanmaku=i()}(this,function(){return function(t){function i(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.l=!0,a.exports}var n={};return i.m=t,i.c=n,i.d=function(t,n,e){i.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:e})},i.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(n,"a",n),n},i.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},i.p="",i(i.s=0)}([function(t,i,n){"use strict";function e(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var a=function(){function t(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,n,e){return n&&t(i.prototype,n),e&&t(i,e),i}}(),s=n(1),o=n(2),u=n(3),d=0;setInterval(function(){d=0},2e3);var r=function(){function t(i){e(this,t),this.danmaku_store=new Array,this.danmaku_sort=new Array,this.danmaku_video=new Array,this.danmaku_speed=2,this.danmaku_played=!0,this.canvas=i.ele||s,this.ctx=this.canvas.getContext("2d"),this.ctx.font=o.weight+" "+o.size+"px "+o.family,this.ctx.strokeStyle="#000000",this.ctx.fillStyle="#ffffff",this.ctx.lineWidth=1,this.position_x=this.canvas.width,this.media=i.media,i.type?(this.add_danmaku(i.danmaku),this.canvas.addEventListener("mouseup",this.danmaku_search.bind(this)),this.canvas.addEventListener("contextmenu",function(){event.preventDefault()}),this.media.addEventListener("play",function(){this.danmaku_played=!0,requestAnimationFrame(this.danmaku_animation.bind(this)),requestAnimationFrame(this.danmaku_video_add_animation.bind(this))}.bind(this)),this.media.addEventListener("pause",function(){this.danmaku_played=!1}.bind(this))):requestAnimationFrame(this.danmaku_animation.bind(this))}return a(t,[{key:"add_danmaku",value:function(t){this.danmaku_store=this.danmaku_store.concat(t),this.danmaku_sort_reset()}},{key:"danmaku_animation",value:function(){this.ctx.clearRect(0,0,1200,700);for(var t=0;t<this.danmaku_video.length;t++)this.ctx.fillText(this.danmaku_video[t].content,this.danmaku_video[t].position_x,this.danmaku_video[t].position_y),this.ctx.strokeText(this.danmaku_video[t].content,this.danmaku_video[t].position_x,this.danmaku_video[t].position_y),this.danmaku_video[t].position_x-=this.danmaku_speed,this.danmaku_video[t].position_x<-this.danmaku_video[t].content.length*o.size&&(this.danmaku_video.splice(t,1),t--);this.danmaku_played&&requestAnimationFrame(this.danmaku_animation.bind(this))}},{key:"danmaku_video_add_animation",value:function(){for(var t=0;t<this.danmaku_sort.length&&(this.danmaku_sort.length>0&&this.danmaku_sort[0].time<this.media.currentTime);t++)this.danmaku_sort[0].position_x=this.position_x,this.danmaku_sort[0].position_y=(d+1)*o.size,this.danmaku_video.push(new u(this.danmaku_sort[0].content,this.danmaku_sort[0].time,this.position_x,(d+1)*o.size)),this.danmaku_sort.splice(0,1),this.height(),t--;this.danmaku_played&&requestAnimationFrame(this.danmaku_video_add_animation.bind(this))}},{key:"danmaku_sort_reset",value:function(){this.danmaku_sort=[].concat(this.danmaku_store),this.danmaku_sort.sort(function(t,i){return t.time-i.time});for(var t=0;t<this.danmaku_sort.length;t++)this.danmaku_sort[0].time<this.media.currentTime&&(this.danmaku_sort.splice(0,1),t--)}},{key:"danmaku_search",value:function(t){if(2==t.button){for(var i,n=t.offsetX,e=t.offsetY,a=this.danmaku_video.length-1;a>=0;a--)if(n-this.danmaku_video[a].position_x>0&&n-this.danmaku_video[a].position_x<this.danmaku_video[a].content.length*o.size&&this.danmaku_video[a].position_y-e>0&&this.danmaku_video[a].position_y-e<o.size){i=this.danmaku_video[a];break}if(i)for(var s=0;s<this.danmaku_store.length;s++)if(this.danmaku_store[s].time==i.time&&this.danmaku_store[s].content==i.content){var u=this.danmaku_store.indexOf(this.danmaku_store[s]);console.log(this.danmaku_store[u])}console.log("end")}}},{key:"danmaku_input",value:function(t){this.danmaku_video.push(new u(t,0,this.position_x,(d+1)*o.size)),this.height()}},{key:"height",value:function(){d>this.canvas.height?d=0:d++}}]),t}();t.exports=r},function(t,i,n){"use strict";var e=document.createElement("canvas");t.exports=e},function(t,i,n){"use strict";var e={style:"normal",variant:"normal",weight:"900",family:"SimHei",size:30};t.exports=e},function(t,i,n){"use strict";function e(t,i,n,e){this.content=t,this.time=i,this.position_x=n,this.position_y=e}t.exports=e}])});